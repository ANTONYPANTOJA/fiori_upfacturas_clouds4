<mvc:View
    controllerName="ns.asa.zappuploadinvoices.controller.MainList"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:semantic="sap.m.semantic"
    displayBlock="true"
    xmlns:footerbar="sap.ushell.ui.footerbar"
    xmlns:unified="sap.ui.unified"
    xmlns:f="sap.ui.layout.form"
    xmlns:smarttable="sap.ui.comp.smarttable" 
    xmlns:smartfield="sap.ui.comp.smartfield"
    xmlns:smartlink="sap.ui.comp.navpopover"
    xmlns:table="sap.ui.table"
	core:require="{formatter: 'ns/asa/zappuploadinvoices/model/formatter'}">

    <Page id="PageMain">
        <content>
        <VBox fitContainer="true" id="VboxMain">
         <Panel>
         <!--CABECERA-->
         <FlexBox visible="true" height="2rem" justifyContent="Start" class="sapUiSmallMarginTop" >
            <Text text="{i18n>plantilla}" visible="true" class="sapUiTinyMarginEnd sapUiTinyMarginTop sapUiMediumMarginBegin"/>
            <Button class="sapUiTinyMarginBegin" type="Ghost" tooltip="{i18n>DownloadTemplate}" text="{i18n>DownloadTemplateText}" 
                    icon="sap-icon://document"
                    press="onDownloadPress"/>
         </FlexBox>
         
         <FlexBox visible="true" height="2rem" justifyContent="Start" class="sapUiSmallMarginTop">
         <Text text="{i18n>origen}" visible="true" class="sapUiTinyMarginEnd sapUiTinyMarginTop sapUiMediumMarginBegin"/>
	      <unified:FileUploader name="postingExcelUpload" width="500px" tooltip="{i18n>SelectFile}"
							    change="onFileChange" icon="sap-icon://open-folder"  
                                uploadComplete="handleUploadCompleted" 
                                uploadAborted="handleUploadAborted"
							    fileAllowed="onFileAllowed" 
                                fileType="xlsx" 
                                sendXHR="true" 
                                style="Emphasized"
                                sameFilenameAllowed="true" 
                                uploadOnChange="false" 
                                useMultipart="false"
							    placeholder="{i18n>UploadHint}" maximumFileSize="100" fileSizeExceed="onFileSizeExceed"/>
         </FlexBox>
         </Panel>
         
         <VBox class="sapUiMediumMarginBeginEnd sapUiTinyMarginTopBottom" visible="false"/>

         <!--REPORTE DETALLE-->
<smarttable:SmartTable id="detail" tableType="ResponsiveTable" showRowCount="true" enableExport="true"
						enableAutoColumnWidth="true" showDetailsButton="true" beforeExport="onBeforeExport"
					    enableAutoBinding="true" class="sapFioriListReportTable" beforeRebindTable="onBeforeRebindViewTable"
				        initialise="onSmartTableInitialise" useVariantManagement="false" height="100%"
                        header="{i18n>Table_Header}" demandPopin="true" entitySet="InvoiceList"
						ignoreFromPersonalisation="Supplierinvoiceuploaduuid,Id">
         
         <smarttable:customData>
			<core:CustomData key="dateFormatSettings" value='\{"UTC":true,"style":"short"\}'/>
			</smarttable:customData>

         <smarttable:layoutData>
			<FlexItemData growFactor="1"/>
			</smarttable:layoutData>

         <!-- Botones Tabla-->
         <smarttable:customToolbar>
						<Toolbar design="Transparent">
							<ToolbarSpacer></ToolbarSpacer>
							<Button id="btnCheck" tooltip="{i18n>Check}" text="{i18n>Check}" press="onCheckPressed" type="Ghost" visible="true"/>
							<Button id="btnPost" tooltip="{i18n>Post}" text="{i18n>Post}" press="onPostPressed" enabled="{ui>/postBtnEnabled}" type="Transparent" visible="true" />
							<Button id="btnDelete" tooltip="{i18n>Delete}" type="Transparent" text="{i18n>Delete}" press="onDeletePress" visible="true"/>
							<Button id="btnEdit" tooltip="{i18n>Edit}" type="Transparent" text="{i18n>Edit}" press="onEditPress" enabled="{ui>/postBtnEnabled}" visible="true" />
							<Button id="btnShowLog" tooltip="{i18n>ShowLog}" type="Transparent" text="{i18n>ShowLog}" press="onShowLogButtonPressed" visible="true"/>
						</Toolbar>
		</smarttable:customToolbar>

            <Table id="tablefact" growing="true" growingScrollToLoad="true" growingThreshold="100" mode="MultiSelect"
						 fixedLayout="true" selectionChange="onRowSelectionChange" itemPress="handleItemPressed">

				<columns>
					<Column hAlign="Begin" tooltip="{/#InvoiceList/Reference/@sap:label}" visible="true">
							<Label text="{/#InvoiceList/Reference/@sap:label}"/>
								<customData>
									<core:CustomData key="p13nData" value='\{"columnKey": "Reference", "leadingProperty": "Reference", "sortProperty": "Reference", "filterProperty": "Reference",  "columnIndex": "1"\}'/>
								</customData>
					</Column>
					<Column hAlign="Begin" tooltip="{/#InvoiceList/Status/@sap:label}" visible="true">
								<Label  text="{/#InvoiceList/InvoiceStatus/@sap:label}"/>
								<customData>
									<core:CustomData key="p13nData" value='\{"columnKey": "InvoiceStatus", "leadingProperty": "InvoiceStatus", "sortProperty": "InvoiceStatus", "filterProperty": "InvoiceStatus", "columnIndex": "2"\}'/>
								</customData>
					</Column>
					<Column hAlign="Begin" tooltip="{/#InvoiceList/CompanyCode/@sap:label}" visible="true">
								<Label text="{/#InvoiceList/CompanyCode/@sap:label}"/>
								<customData>
									<core:CustomData key="p13nData" value='\{"columnKey": "CompanyCode", "leadingProperty": "CompanyCode", "sortProperty": "CompanyCode", "filterProperty": "CompanyCode", "columnIndex": "3"\}'/>
								</customData>
					</Column>
						<Column hAlign="Begin" tooltip="{/#InvoiceList/InvoicingParty/@sap:label}"
								visible="true">
								<Label text="{/#InvoiceList/InvoicingParty/@sap:label}"/>
								<customData>
									<core:CustomData key="p13nData" value='\{"columnKey": "InvoicingParty", "leadingProperty": "InvoicingParty", "sortProperty": "InvoicingParty", "filterProperty": "InvoicingParty", "columnIndex": "4"\}'/>
								</customData>
							</Column>
							<Column hAlign="End"  tooltip="{/#InvoiceList/PostingDate/@sap:label}"
								visible="true">
								<Label text="{/#InvoiceList/PostingDate/@sap:label}"/>
								<customData>
									<core:CustomData key="p13nData" value='\{"columnKey": "PostingDate", "leadingProperty": "PostingDate", "sortProperty": "PostingDate", "filterProperty": "PostingDate", "columnIndex": "5", "type": "date"\}'/>
								</customData>
							</Column>
							<Column hAlign="End"  tooltip="{/#InvoiceList/DocumentDate/@sap:label}"
								visible="true">
								<Label text="{/#InvoiceList/DocumentDate/@sap:label}"/>
								<customData>
									<core:CustomData key="p13nData"
										value='\{"columnKey": "DocumentDate", "leadingProperty": "DocumentDate", "sortProperty": "DocumentDate", "filterProperty": "DocumentDate", "columnIndex": "6", "type": "date"\}'/>
								</customData>
							</Column>
							<Column hAlign="Begin" tooltip="{/#InvoiceList/SupplierInvoice/@sap:label}"
								visible="true">
								<Label text="{/#InvoiceList/SupplierInvoice/@sap:label}"/>
								<customData>
									<core:CustomData key="p13nData" value='\{"columnKey": "SupplierInvoice", "leadingProperty": "SupplierInvoice", "sortProperty": "SupplierInvoice", "filterProperty": "SupplierInvoice", "columnIndex": "7"\}'/>
								</customData>
							</Column>
							<Column hAlign="End" tooltip="{/#InvoiceList/Amount/@sap:label}" visible="true">
								<Label text="{/#InvoiceList/Amount/@sap:label}"/>
									<customData>
									<core:CustomData key="p13nData" value='\{"columnKey": "Amount", "leadingProperty": "Amount", "sortProperty": "Amount", "filterProperty": "Amount", "columnIndex": "8"\}'/>
							 	</customData>
							</Column>												
				</columns>
               <items>
               	<ColumnListItem type="Navigation" highlight="{path:'CheckStatus', formatter:'formatter.DraftStatusStateFormat'}">
								<cells>
									<Text wrapping="false" text="{Reference}"/>
									<Text wrapping="false" text="{parts: [{path:'InvoiceStatus'},{ path:'DraftStatus'},{ path:'InvoiceStatusDesc'}], formatter: '.formatter.InvoiceStatusFormat' }"/>
									<Text wrapping="false" text="{parts: [{path:'CompanyCode'},{ path:'CompanyCodeName'}], formatter: '.formatter.KeyTextFormat' }"/>
									<Text wrapping="false" text="{parts: [{path:'InvoicingParty'},{ path:'InvoicingPartyName'}], formatter: '.formatter.KeyTextFormat' }"/>
									<Text text="{path:'PostingDate', type:'sap.ui.model.type.Date', formatOptions:{pattern: 'dd/MM/yyyy', strictParsing: true , UTC:'true'} }"/>
									<Text text="{path:'DocumentDate', type:'sap.ui.model.type.Date', formatOptions:{pattern: 'dd/MM/yyyy', strictParsing: true , UTC:'true'} }"/>
									<Text wrapping="false" text="{parts: [{path:'SupplierInvoice'},{ path:'FiscalYear'}], formatter: '.formatter.InvoiceWithYear'}"/>
									<!-- 
									<unified:Currency value="{path:'Amount', type:'sap.ui.model.type.String'}" currency="{Currency}" useSymbol="false"/>
									<unified:Currency stringValue="{Amount}" currency="{Currency}" useSymbol="false"/> -->

								</cells>
				</ColumnListItem>
               </items>
				</Table>
         </smarttable:SmartTable>		 
      </VBox>
   </content>
    </Page>
</mvc:View>
